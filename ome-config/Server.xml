<?xml version="1.0" encoding="UTF-8"?>
<Server version="8" type="origin">
  <Name>OvenMediaEngine</Name>

  <Hosts>
    <Host>
      <Name>default</Name>
      <IP>*</IP>

      <VirtualHosts>
        <VirtualHost>
          <Name>default</Name>
          <Domain>*</Domain>

          <Applications>
            <Application>
              <Name>app</Name>
              <Type>live</Type>
              
              <Transcoder>
                <Enable>true</Enable>
                <Codec>
                  <Video>
                    <H264>
                      <Preset>faster</Preset>
                      <Profile>baseline</Profile>
                      <KeyFrameInterval>60</KeyFrameInterval>
                      <CBR>true</CBR>
                    </H264>
                  </Video>
                  <Audio>
                    <Opus>
                      <Bitrate>128000</Bitrate>
                      <Channel>2</Channel>
                      <Complexity>10</Complexity>
                      <Frame>20</Frame>
                    </Opus>
                  </Audio>
                </Codec>
                <Streams>
                  <Stream>
                    <n>bypass_stream</n>
                    <Profiles>
                      <Profile>
                        <n>bypass_all</n>
                        <Video>
                          <Bypass>true</Bypass>
                        </Video>
                        <Audio>
                          <Bypass>true</Bypass>
                        </Audio>
                      </Profile>
                    </Profiles>
                  </Stream>
                  <Stream>
                    <n>transrate_stream</n>
                    <Profiles>
                      <Profile>
                        <n>video_profile</n>
                        <Video>
                          <Codec>H264</Codec>
                          <Width>1280</Width>
                          <Height>720</Height>
                          <Bitrate>2500000</Bitrate>
                          <Framerate>30</Framerate>
                        </Video>
                        <Audio>
                          <Codec>Opus</Codec>
                          <Bitrate>128000</Bitrate>
                          <Samplerate>48000</Samplerate>
                          <Channel>2</Channel>
                        </Audio>
                      </Profile>
                    </Profiles>
                  </Stream>
                </Streams>
              </Transcoder>

              <Publishers>
                <RtmpPush>
                  <Enable>true</Enable>
                  <SocketAddrs>
                    <SocketAddr>
                      <Port>1935</Port>
                    </SocketAddr>
                  </SocketAddrs>
                </RtmpPush>

                <WebRTC>
                  <Enable>true</Enable>
                  <Port>3333</Port>
                  <Timeout>30000</Timeout>
                  <CrossDomains>
                    <Url>*</Url>
                  </CrossDomains>
                  <SessionTimeout>180000</SessionTimeout>
                  <CandidatePort>
                    <Port>10000/tcp</Port>
                    <Port>10000-10004/udp</Port>
                  </CandidatePort>
                </WebRTC>

                <LLHLS>
                  <Enable>true</Enable>
                  <SegmentDuration>2</SegmentDuration>
                  <ChunkDuration>0.5</ChunkDuration>
                  <SegmentCount>5</SegmentCount>
                  <CrossDomains>
                    <Url>*</Url>
                  </CrossDomains>
                  <StreamRelay>
                    <Enabled>true</Enabled>
                    <BindAddress>*:8080</BindAddress>
                  </StreamRelay>
                </LLHLS>
              </Publishers>
            </Application>
          </Applications>
        </VirtualHost>
      </VirtualHosts>
    </Host>
  </Hosts>

  <Bind>
    <Managers>
      <API>
        <Port>8081</Port>
      </API>
    </Managers>

    <Publishers>
      <LLHLS>
        <Port>8080</Port>
        <WorkerCount>2</WorkerCount>
      </LLHLS>
    </Publishers>

    <WebRTC>
      <IceCandidates>
        <IceCandidate>*:10000-10004/udp</IceCandidate>
      </IceCandidates>
      <TcpRelay>
        <Listen>*:3478</Listen>
        <TcpForwarding>true</TcpForwarding>
        <Protocol>tcp</Protocol>
      </TcpRelay>
    </WebRTC>
  </Bind>
</Server>